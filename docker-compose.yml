version: "3"

services:
  water_rights_visualizer_ui:
    build:
      context: .
      dockerfile: Dockerfile.ui
    container_name: water-rights-visualizer-ui
    ports:
      - "8000:8000"
    depends_on:
      - water_rights_visualizer_backend
      - water_rights_visualizer_api
    networks:
      - water_network

  water_rights_visualizer_api:
    build:
      context: .
      dockerfile: Dockerfile.api
    container_name: water-rights-visualizer-api
    restart: always
    command: "/init-api.sh ${WATER_RIGHTS_SOURCE:-S3}"
    environment:
      MONGO_INITDB_ROOT_USERNAME: ${MONGO_INITDB_ROOT_USERNAME:-admin}
      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_INITDB_ROOT_PASSWORD:-mypassword}
      MONGO_HOST: ${MONGO_HOST:-water-rights-visualizer-mongo}
      MONGO_PORT: ${MONGO_PORT:-27017}
      MONGO_DATABASE: ${MONGO_DATABASE:-water}
      MONGO_COLLECTION: ${MONGO_COLLECTION:-report_queue}
      AUTH0_DOMAIN: ${AUTH0_DOMAIN:-water-rights-visualizer.us.auth0.com}
      AUTH0_CLIENT_ID: ${AUTH0_CLIENT_ID:-WwEYqC6Ji9pqUdTC0MXqM2kgQQv4NxAy}
      AUTH0_SECRET: ${AUTH0_SECRET:-de471589294cc129aa117112a5ecb56b9ead3b5a5211a50e2d336bb91de5f6b5}
      AUTH0_BASE_URL: ${AUTH0_BASE_URL:-http://localhost:5173}
      AUTH0_ISSUER_BASE_URL: ${AUTH0_ISSUER_BASE_URL:-https://water-rights-visualizer.us.auth0.com}
      AUTH0_AUDIENCE: ${AUTH0_AUDIENCE:-https://nmw-dev.jpl.nasa.gov/api}
    ports:
      - "5000:5000"
    depends_on:
      - water_mongo
    volumes:
      - ${HOST_DATA_DIRECTORY:-${HOME}/data}:${CONTAINER_DATA_DIRECTORY:-/root/data}
    networks:
      - water_network

  water_rights_visualizer_backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
    container_name: water-rights-visualizer
    restart: always
    command: "/init.sh ${WATER_RIGHTS_SOURCE:-S3}"
    depends_on:
      - water_mongo
    volumes:
      - ${HOST_DATA_DIRECTORY:-${HOME}/data}:${CONTAINER_DATA_DIRECTORY:-/root/data}
    networks:
      - water_network

  water_mongo:
    image: mongo:7.0
    container_name: water-rights-visualizer-mongo
    environment:
      MONGO_INITDB_ROOT_USERNAME: ${MONGO_INITDB_ROOT_USERNAME:-admin}
      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_INITDB_ROOT_PASSWORD:-mypassword}
    ports:
      - 27017:27017
    volumes:
      - mongodata:/data/db
    networks:
      - water_network

volumes:
  mongodata:
    driver: local

networks:
  water_network:
